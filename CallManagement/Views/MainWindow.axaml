<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CallManagement.ViewModels"
        xmlns:models="using:CallManagement.Models"
        xmlns:conv="using:CallManagement.Converters"
        xmlns:local="using:CallManagement.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="CallManagement.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Call Manager"
        MinWidth="900"
        MinHeight="600"
        Background="{DynamicResource AppBackgroundBrush}">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- CONVERTERS -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <Window.Resources>
        <conv:CallStatusToStringConverter x:Key="StatusToString"/>
        <conv:CallStatusToBackgroundConverter x:Key="StatusToBackground"/>
        <conv:CallStatusToForegroundConverter x:Key="StatusToForeground"/>
        <conv:StepToVisibilityConverter x:Key="StepToVisibility"/>
        <conv:InverseBoolConverter x:Key="InverseBool"/>
        <conv:StepIndicatorBrushConverter x:Key="StepIndicatorBrush"/>
        <conv:StringHasContentConverter x:Key="StringHasContent"/>
        <conv:StringToPlaceholderVisibilityConverter x:Key="StringToPlaceholder"/>
        <conv:BoolToFontWeightConverter x:Key="BoolToFontWeightConverter"/>
        <conv:BoolToBrushConverter x:Key="BoolToBrushConverter"/>
        <conv:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
        <conv:BoolToSavingTextConverter x:Key="BoolToSavingTextConverter"/>
        <conv:StringNotEmptyConverter x:Key="StringNotEmpty"/>
    </Window.Resources>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MAIN LAYOUT -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <Grid RowDefinitions="Auto,*">
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- TOP BAR -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0"
                Background="{DynamicResource TopBarBackgroundBrush}"
                BorderBrush="{DynamicResource BorderLightBrush}"
                BorderThickness="0,0,0,1"
                Padding="20,12">
            <Grid ColumnDefinitions="Auto,*,Auto">
                
                <!-- Logo + App Name -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                    <!-- App Icon -->
                    <Border Width="36" Height="36" CornerRadius="8" Background="{DynamicResource PrimaryBrush}">
                        <TextBlock Text="ðŸ“ž" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Classes="appTitle" Text="Call Manager" VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    
                    <!-- Import Button -->
                    <Button Classes="topBarButton" 
                            x:Name="ImportButton"
                            Command="{Binding ImportExcelCommand}"
                            ToolTip.Tip="Import file Excel chá»©a danh sÃ¡ch gá»i (âŒ˜I / Ctrl+I)">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“¥" FontSize="16"/>
                            <TextBlock Text="Import Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Export Button -->
                    <Button Classes="topBarButton"
                            x:Name="ExportButton"
                            Command="{Binding ExportExcelCommand}"
                            ToolTip.Tip="Xuáº¥t káº¿t quáº£ cuá»™c gá»i ra file Excel (âŒ˜E / Ctrl+E)">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“¤" FontSize="16"/>
                            <TextBlock Text="Export Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Send Report Button -->
                    <Button Classes="topBarButton"
                            x:Name="SendReportButton"
                            Command="{Binding OpenSendReportCommand}"
                            ToolTip.Tip="Gá»­i bÃ¡o cÃ¡o Excel qua Telegram">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“¨" FontSize="16"/>
                            <TextBlock Text="Send Report" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Send Daily Report Button - Always visible, can send manual anytime -->
                    <Button Classes="topBarButton"
                            x:Name="SendDailyReportButton"
                            Command="{Binding SendDailyReportCommand}"
                            ToolTip.Tip="Gá»­i Daily Report qua Telegram (Manual)">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ“Š" FontSize="16"/>
                            <TextBlock Text="Daily Report" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Auto Daily Report Indicator - Shown when auto-send is enabled -->
                    <Border IsVisible="{Binding IsAutoSendDailyReportEnabled}"
                            Background="{DynamicResource SuccessLightBrush}"
                            CornerRadius="6"
                            Padding="8,4"
                            VerticalAlignment="Center"
                            ToolTip.Tip="Auto-send Ä‘ang báº­t. Daily Report sáº½ Ä‘Æ°á»£c gá»­i tá»± Ä‘á»™ng theo giá» cáº¥u hÃ¬nh.">
                        <TextBlock Text="â° Auto" 
                                   FontSize="11" 
                                   FontWeight="Medium"
                                   Foreground="{DynamicResource SuccessTextBrush}"
                                   VerticalAlignment="Center"/>
                    </Border>
                    
                    <!-- Separator -->
                    <Border Width="1" Height="24" Background="{DynamicResource BorderLightBrush}" Margin="8,0"/>
                    
                    <!-- Save Session Button -->
                    <Button Classes="topBarButton primary"
                            Command="{Binding SaveSessionCommand}"
                            IsEnabled="{Binding IsCurrentTabEditable}"
                            ToolTip.Tip="LÆ°u phiÃªn hiá»‡n táº¡i vÃ o database (âŒ˜S / Ctrl+S)">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ’¾" FontSize="16"/>
                            <TextBlock Text="Save Session" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Clear Session Button -->
                    <Button Classes="topBarButton"
                            Command="{Binding ClearCurrentSessionCommand}"
                            IsEnabled="{Binding IsCurrentTabEditable}"
                            ToolTip.Tip="XÃ³a dá»¯ liá»‡u phiÃªn hiá»‡n táº¡i">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ—‘ï¸" FontSize="16"/>
                            <TextBlock Text="Clear" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Separator -->
                    <Border Width="1" Height="24" Background="{DynamicResource BorderLightBrush}" Margin="8,0"/>
                    
                    <!-- Help Button -->
                    <Button Classes="iconButton"
                            Command="{Binding ShowHelpCommand}"
                            ToolTip.Tip="Xem hÆ°á»›ng dáº«n sá»­ dá»¥ng">
                        <TextBlock Text="â“" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    
                    <!-- Settings Button -->
                    <Button Classes="iconButton"
                            Command="{Binding OpenSettingsCommand}"
                            ToolTip.Tip="CÃ i Ä‘áº·t (Settings)">
                        <TextBlock Text="âš™ï¸" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- LOADING OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0" Grid.RowSpan="2"
                IsVisible="{Binding IsLoading}"
                Background="{DynamicResource OverlayBackgroundBrush}"
                ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding StatusMessage}" 
                           Classes="bodySecondary"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- MAIN CONTENT AREA WITH TABCONTROL -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="1" ColumnDefinitions="240,*">
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- SIDEBAR -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Border Grid.Column="0"
                    Background="{DynamicResource SidebarBackgroundBrush}"
                    BorderBrush="{DynamicResource BorderLightBrush}"
                    BorderThickness="0,0,1,0"
                    IsVisible="{Binding IsSidebarVisible}">
                <Grid RowDefinitions="Auto,*,Auto">
                    
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <!-- SIDEBAR HEADER -->
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <Border Grid.Row="0" 
                            Padding="16,12"
                            BorderBrush="{DynamicResource BorderLightBrush}"
                            BorderThickness="0,0,0,1">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Classes="heading3" Text="ðŸ“‚ Sessions" VerticalAlignment="Center"/>
                            <Button Grid.Column="1"
                                    Classes="iconButton"
                                    Command="{Binding RefreshSessionsCommand}"
                                    ToolTip.Tip="Refresh sessions">
                                <TextBlock Text="ðŸ”„" FontSize="14"/>
                            </Button>
                        </Grid>
                    </Border>
                    
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <!-- SESSIONS LIST -->
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <ListBox Grid.Row="1" 
                             ItemsSource="{Binding Sessions}"
                             SelectedItem="{Binding SelectedSession, Mode=TwoWay}"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="8"
                             Classes="sessionListBox">
                        <ListBox.Styles>
                            <!-- Remove default ListBox selection styling -->
                            <Style Selector="ListBoxItem">
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,2"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="CornerRadius" Value="8"/>
                                <Setter Property="Cursor" Value="Hand"/>
                            </Style>
                            <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource NeutralLightBrush}"/>
                            </Style>
                            <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
                            </Style>
                            <Style Selector="ListBoxItem:selected:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource PrimaryHoverBrush}"/>
                            </Style>
                        </ListBox.Styles>
                        
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:SessionListItemViewModel">
                                <Grid ColumnDefinitions="Auto,*,Auto" Margin="12,10">
                                    <!-- Icon -->
                                    <TextBlock Grid.Column="0" 
                                               Text="{Binding Icon}" 
                                               FontSize="14"
                                               VerticalAlignment="Center"
                                               Margin="0,0,10,0"/>
                                    
                                    <!-- Session Name/Time -->
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding DisplayTime}"
                                               Classes="body"
                                               VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               FontWeight="{Binding IsCurrent, Converter={StaticResource BoolToFontWeightConverter}}"/>
                                    
                                    <!-- Contact Count Badge -->
                                    <Border Grid.Column="2"
                                            IsVisible="{Binding !IsCurrent}"
                                            Background="{DynamicResource NeutralLightBrush}"
                                            CornerRadius="10"
                                            Padding="6,2"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding ContactCount}"
                                                   FontSize="11"
                                                   Foreground="{DynamicResource TextMutedBrush}"/>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <!-- STATISTICS PANEL (Bottom) -->
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <Border Grid.Row="2"
                            BorderBrush="{DynamicResource BorderLightBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="12">
                        <StackPanel Spacing="8">
                            <TextBlock Classes="caption" Text="ðŸ“Š Statistics" FontWeight="SemiBold"/>
                            
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" Margin="0,4,0,0">
                                <!-- Total -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Classes="caption" Text="Total" Foreground="{DynamicResource TextMutedBrush}"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Classes="body" Text="{Binding TotalCount}" FontWeight="SemiBold"/>
                                
                                <!-- Interested (CÃ³ nhu cáº§u) -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                    <Border Width="8" Height="8" CornerRadius="4" Background="{DynamicResource SuccessBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Classes="caption" Text="CÃ³ nhu cáº§u" Foreground="{DynamicResource TextMutedBrush}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="1" Grid.Column="1" Classes="body" Text="{Binding InterestedCount}" Foreground="{DynamicResource SuccessTextBrush}" Margin="0,4,0,0"/>
                                
                                <!-- Not Interested (KhÃ´ng nhu cáº§u) -->
                                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                    <Border Width="8" Height="8" CornerRadius="4" Background="{DynamicResource ErrorBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Classes="caption" Text="KhÃ´ng nhu cáº§u" Foreground="{DynamicResource TextMutedBrush}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="2" Grid.Column="1" Classes="body" Text="{Binding NotInterestedCount}" Foreground="{DynamicResource ErrorTextBrush}" Margin="0,4,0,0"/>
                                
                                <!-- No Answer (KhÃ´ng báº¯t mÃ¡y) -->
                                <StackPanel Grid.Row="3" Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                    <Border Width="8" Height="8" CornerRadius="4" Background="{DynamicResource NeutralBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Classes="caption" Text="KhÃ´ng báº¯t mÃ¡y" Foreground="{DynamicResource TextMutedBrush}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="3" Grid.Column="1" Classes="body" Text="{Binding NoAnswerCount}" Foreground="{DynamicResource NeutralTextBrush}" Margin="0,4,0,0"/>
                                
                                <!-- Busy (MÃ¡y báº­n) -->
                                <StackPanel Grid.Row="4" Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                    <Border Width="8" Height="8" CornerRadius="4" Background="{DynamicResource WarningBrush}" VerticalAlignment="Center"/>
                                    <TextBlock Classes="caption" Text="MÃ¡y báº­n" Foreground="{DynamicResource TextMutedBrush}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="4" Grid.Column="1" Classes="body" Text="{Binding BusyCount}" Foreground="{DynamicResource WarningTextBrush}" Margin="0,4,0,0"/>
                                
                                <!-- Invalid Number (Sá»‘ khÃ´ng tá»“n táº¡i) -->
                                <StackPanel Grid.Row="5" Grid.Column="0" Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                    <Border Width="8" Height="8" CornerRadius="4" Background="#7F1D1D" VerticalAlignment="Center"/>
                                    <TextBlock Classes="caption" Text="Sá»‘ khÃ´ng tá»“n táº¡i" Foreground="{DynamicResource TextMutedBrush}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="5" Grid.Column="1" Classes="body" Text="{Binding InvalidCount}" Foreground="#7F1D1D" Margin="0,4,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- DATA GRID AREA WITH TABCONTROL -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Border Grid.Column="1" Padding="20" Classes="fadeIn">
                <Grid RowDefinitions="Auto,*">
                    
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <!-- TAB HEADERS -->
                    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                    <TabControl Grid.Row="0" 
                                Grid.RowSpan="2"
                                ItemsSource="{Binding Tabs}"
                                SelectedItem="{Binding SelectedTab}"
                                TabStripPlacement="Top"
                                Classes="sessionTabs">
                        
                        <!-- Tab Header Template -->
                        <TabControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:SessionTabViewModel">
                                <Grid ColumnDefinitions="Auto,Auto,Auto" Margin="4,2">
                                    <!-- Tab Title -->
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Title}"
                                               VerticalAlignment="Center"
                                               FontWeight="{Binding IsCurrentSession, Converter={StaticResource BoolToFontWeightConverter}}"
                                               Foreground="{Binding IsCurrentSession, Converter={StaticResource BoolToBrushConverter}}"/>
                                    
                                    <!-- Contact Count Badge -->
                                    <Border Grid.Column="1"
                                            Background="{DynamicResource NeutralLightBrush}"
                                            CornerRadius="8"
                                            Padding="6,2"
                                            Margin="8,0,0,0"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Contacts.Count}"
                                                   FontSize="10"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    </Border>
                                    
                                    <!-- Close Button (only for history tabs) -->
                                    <Button Grid.Column="2"
                                            Classes="iconButton"
                                            Width="20" Height="20"
                                            Margin="8,0,0,0"
                                            IsVisible="{Binding IsCurrentSession, Converter={StaticResource InverseBool}}"
                                            Command="{Binding $parent[TabControl].((vm:MainWindowViewModel)DataContext).CloseTabCommand}"
                                            CommandParameter="{Binding}"
                                            ToolTip.Tip="ÄÃ³ng tab (dá»¯ liá»‡u váº«n Ä‘Æ°á»£c lÆ°u)">
                                        <TextBlock Text="âœ•" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                        
                        <!-- Tab Content Template -->
                        <TabControl.ContentTemplate>
                            <DataTemplate x:DataType="vm:SessionTabViewModel">
                                <Border Classes="card" Padding="0" ClipToBounds="True" Margin="0,12,0,0">
                                    <Grid RowDefinitions="Auto,Auto,Auto,*">
                                        
                                        <!-- Session Info Bar (for history tabs) -->
                                        <Border Grid.Row="0"
                                                IsVisible="{Binding IsCurrentSession, Converter={StaticResource InverseBool}}"
                                                Background="{DynamicResource WarningLightBrush}"
                                                Padding="12,8"
                                                BorderBrush="{DynamicResource BorderLightBrush}"
                                                BorderThickness="0,0,0,1">
                                            <Grid ColumnDefinitions="*,Auto">
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="ðŸ“…" FontSize="14" VerticalAlignment="Center"/>
                                                    <TextBlock Text="PhiÃªn Ä‘Ã£ lÆ°u:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding SessionKey}" 
                                                               FontFamily="Consolas, Menlo, monospace"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Text="â€¢" VerticalAlignment="Center" Margin="8,0"/>
                                                    <TextBlock Text="Chá»‰ xem (Read-only)" 
                                                               FontStyle="Italic"
                                                               Foreground="{DynamicResource TextMutedBrush}"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <!-- Delete Session Button -->
                                                <Button Grid.Column="1"
                                                        Classes="iconButton error"
                                                        Width="28" Height="28"
                                                        Command="{Binding $parent[TabControl].((vm:MainWindowViewModel)DataContext).RequestDeleteSessionCommand}"
                                                        CommandParameter="{Binding}"
                                                        ToolTip.Tip="XÃ³a phiÃªn nÃ y khá»i database">
                                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Button>
                                            </Grid>
                                        </Border>
                                        
                                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                        <!-- SEARCH / FILTER TOOLBAR -->
                                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                        <Border Grid.Row="1"
                                                Background="{DynamicResource AppBackgroundBrush}"
                                                Padding="16,10"
                                                BorderBrush="{DynamicResource BorderLightBrush}"
                                                BorderThickness="0,0,0,1">
                                            <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" 
                                                  RowDefinitions="36">
                                                
                                                <!-- Search Box Container -->
                                                <Border Grid.Column="0"
                                                        Background="{DynamicResource CardBackgroundBrush}"
                                                        BorderBrush="{DynamicResource BorderMediumBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="6"
                                                        Height="36"
                                                        MinWidth="320"
                                                        MaxWidth="400"
                                                        VerticalAlignment="Center">
                                                    <Grid ColumnDefinitions="36,*,32">
                                                        <!-- Search Icon -->
                                                        <Border Grid.Column="0"
                                                                Width="36" Height="36">
                                                            <TextBlock Text="ðŸ”" 
                                                                       FontSize="14" 
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"
                                                                       Opacity="0.5"/>
                                                        </Border>
                                                        
                                                        <!-- Search TextBox -->
                                                        <TextBox Grid.Column="1"
                                                                 Text="{Binding SearchText, Mode=TwoWay}"
                                                                 Watermark="TÃ¬m tÃªn, SÄT, cÃ´ng ty, ghi chÃº..."
                                                                 Classes="searchInput"
                                                                 BorderThickness="0"
                                                                 Background="Transparent"
                                                                 Height="34"
                                                                 VerticalAlignment="Center"
                                                                 VerticalContentAlignment="Center"
                                                                 Padding="0,0,4,0"/>
                                                        
                                                        <!-- Clear Button -->
                                                        <Border Grid.Column="2" 
                                                                Width="32" Height="36"
                                                                IsVisible="{Binding SearchText, Converter={StaticResource StringNotEmpty}}">
                                                            <Button Classes="iconButton"
                                                                    Width="28" Height="28"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Command="{Binding ClearSearchCommand}"
                                                                    ToolTip.Tip="XÃ³a tÃ¬m kiáº¿m">
                                                                <TextBlock Text="âœ•" 
                                                                           FontSize="12" 
                                                                           Opacity="0.5" 
                                                                           HorizontalAlignment="Center" 
                                                                           VerticalAlignment="Center"/>
                                                            </Button>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                                
                                                <!-- Status Filter -->
                                                <Grid Grid.Column="1" 
                                                      ColumnDefinitions="Auto,Auto" 
                                                      Margin="16,0,0,0"
                                                      VerticalAlignment="Center">
                                                    <TextBlock Grid.Column="0"
                                                               Text="Lá»c:" 
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                                    <ComboBox Grid.Column="1"
                                                              ItemsSource="{Binding StatusFilterOptions}"
                                                              SelectedItem="{Binding SelectedStatusFilter}"
                                                              MinWidth="170"
                                                              Height="36"
                                                              VerticalAlignment="Center"
                                                              VerticalContentAlignment="Center"
                                                              Classes="filterComboBox">
                                                        <ComboBox.ItemTemplate>
                                                            <DataTemplate x:DataType="models:StatusFilterOption">
                                                                <StackPanel Orientation="Horizontal" 
                                                                            Spacing="8"
                                                                            VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding Icon}" 
                                                                               FontSize="14"
                                                                               VerticalAlignment="Center"/>
                                                                    <TextBlock Text="{Binding DisplayText}"
                                                                               VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ComboBox.ItemTemplate>
                                                    </ComboBox>
                                                </Grid>
                                                
                                                <!-- Spacer -->
                                                <Border Grid.Column="2"/>
                                                
                                                <!-- Results Count Badge -->
                                                <Border Grid.Column="3"
                                                        Background="{DynamicResource NeutralLightBrush}"
                                                        CornerRadius="18"
                                                        Height="36"
                                                        Padding="14,0"
                                                        VerticalAlignment="Center">
                                                    <TextBlock FontSize="12" 
                                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                                               VerticalAlignment="Center">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0} / {1} contacts">
                                                                <Binding Path="Contacts.Count"/>
                                                                <Binding Path="AllContacts.Count"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </Border>
                                                
                                                <!-- Clear All Filters Button -->
                                                <Border Grid.Column="4"
                                                        Width="36" Height="36"
                                                        Margin="8,0,0,0"
                                                        VerticalAlignment="Center">
                                                    <Button Classes="iconButton"
                                                            Width="36" Height="36"
                                                            Command="{Binding ClearAllFiltersCommand}"
                                                            ToolTip.Tip="XÃ³a táº¥t cáº£ bá»™ lá»c">
                                                        <TextBlock Text="ðŸ”„" 
                                                                   FontSize="14"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"/>
                                                    </Button>
                                                </Border>
                                            </Grid>
                                        </Border>
                        
                                        <!-- Table Header with Sortable Columns -->
                                        <Border Grid.Row="2" 
                                                Background="{DynamicResource NeutralLightBrush}" 
                                                Padding="16,8"
                                                BorderBrush="{DynamicResource BorderLightBrush}"
                                                BorderThickness="0,0,0,1">
                                            <Grid ColumnDefinitions="50,*,140,140,100,140,220,50">
                                                <!-- ID (not sortable) -->
                                                <TextBlock Grid.Column="0" Classes="caption" FontWeight="SemiBold" Text="#" VerticalAlignment="Center"/>
                                                
                                                <!-- Name (sortable) -->
                                                <Button Grid.Column="1" 
                                                        Classes="sortableHeader"
                                                        Command="{Binding SortByNameCommand}"
                                                        HorizontalAlignment="Left"
                                                        ToolTip.Tip="Click Ä‘á»ƒ sáº¯p xáº¿p theo tÃªn">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock Classes="caption" FontWeight="SemiBold" Text="TÃªn"/>
                                                        <TextBlock Classes="sortIcon" Text="{Binding NameSortIcon}" FontSize="10" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>
                                                
                                                <!-- Phone (sortable) -->
                                                <Button Grid.Column="2" 
                                                        Classes="sortableHeader"
                                                        Command="{Binding SortByPhoneCommand}"
                                                        HorizontalAlignment="Left"
                                                        ToolTip.Tip="Click Ä‘á»ƒ sáº¯p xáº¿p theo SÄT">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock Classes="caption" FontWeight="SemiBold" Text="Sá»‘ Ä‘iá»‡n thoáº¡i"/>
                                                        <TextBlock Classes="sortIcon" Text="{Binding PhoneSortIcon}" FontSize="10" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>
                                                
                                                <!-- Company (sortable) -->
                                                <Button Grid.Column="3" 
                                                        Classes="sortableHeader"
                                                        Command="{Binding SortByCompanyCommand}"
                                                        HorizontalAlignment="Left"
                                                        ToolTip.Tip="Click Ä‘á»ƒ sáº¯p xáº¿p theo cÃ´ng ty">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock Classes="caption" FontWeight="SemiBold" Text="CÃ´ng ty"/>
                                                        <TextBlock Classes="sortIcon" Text="{Binding CompanySortIcon}" FontSize="10" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>
                                                
                                                <!-- Note (not sortable) -->
                                                <TextBlock Grid.Column="4" Classes="caption" FontWeight="SemiBold" Text="Ghi chÃº" VerticalAlignment="Center"/>
                                                
                                                <!-- Status (sortable) -->
                                                <Button Grid.Column="5" 
                                                        Classes="sortableHeader"
                                                        Command="{Binding SortByStatusCommand}"
                                                        HorizontalAlignment="Left"
                                                        ToolTip.Tip="Click Ä‘á»ƒ sáº¯p xáº¿p theo tráº¡ng thÃ¡i">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <TextBlock Classes="caption" FontWeight="SemiBold" Text="Tráº¡ng thÃ¡i"/>
                                                        <TextBlock Classes="sortIcon" Text="{Binding StatusSortIcon}" FontSize="10" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Button>
                                                
                                                <!-- Actions (not sortable) -->
                                                <TextBlock Grid.Column="6" Classes="caption" FontWeight="SemiBold" Text="HÃ nh Ä‘á»™ng" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="7" Classes="caption" FontWeight="SemiBold" Text="" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                        
                                        <!-- Table Content -->
                                        <Grid Grid.Row="3">
                                            <!-- No Results Message -->
                                            <Border IsVisible="{Binding HasNoResults}"
                                                    Padding="40"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center">
                                                <StackPanel Spacing="12" HorizontalAlignment="Center">
                                                    <TextBlock Text="ðŸ”" FontSize="48" HorizontalAlignment="Center" Opacity="0.5"/>
                                                    <TextBlock Text="{Binding NoResultsMessage}" 
                                                               Classes="bodySecondary"
                                                               HorizontalAlignment="Center"/>
                                                    <Button Classes="secondary"
                                                            Content="XÃ³a bá»™ lá»c"
                                                            Command="{Binding ClearAllFiltersCommand}"
                                                            HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Contacts List -->
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                                          VerticalScrollBarVisibility="Auto"
                                                          IsVisible="{Binding HasNoResults, Converter={StaticResource InverseBool}}">
                                            <ItemsControl ItemsSource="{Binding Contacts}" x:Name="ContactsGrid">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate x:DataType="models:Contact">
                                                        <!-- Main Row Container -->
                                                        <Border x:Name="RowContainer">
                                                            <StackPanel>
                                                                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                                <!-- NORMAL VIEW MODE -->
                                                                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                                <Border x:Name="RowBorder"
                                                                        Classes="contactRow"
                                                                        IsVisible="{Binding IsEditing, Converter={StaticResource InverseBool}}"
                                                                        DoubleTapped="OnRowDoubleTapped"
                                                                        ToolTip.Tip="Double-click Ä‘á»ƒ chá»‰nh sá»­a">
                                                    
                                                                    <Grid ColumnDefinitions="50,*,140,140,100,140,220,50" VerticalAlignment="Center">
                                                                        <!-- ID -->
                                                        <TextBlock Grid.Column="0" 
                                                                   Classes="bodySecondary" 
                                                                   Text="{Binding Id}" 
                                                                   VerticalAlignment="Center"/>
                                                        
                                                        <!-- Name -->
                                                        <TextBlock Grid.Column="1" 
                                                                   Classes="body" 
                                                                   Text="{Binding Name}" 
                                                                   VerticalAlignment="Center"
                                                                   TextTrimming="CharacterEllipsis"/>
                                                        
                                                        <!-- Phone (Monospace) with Copy Button -->
                                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                                            <TextBlock Classes="monospace" 
                                                                       Text="{Binding PhoneNumber}" 
                                                                       VerticalAlignment="Center"
                                                                       Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                            <Button Classes="iconButton"
                                                                    Width="24" Height="24"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CopyPhoneNumberCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    ToolTip.Tip="Sao chÃ©p sá»‘ Ä‘iá»‡n thoáº¡i">
                                                                <TextBlock Text="ðŸ“‹" FontSize="11" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                        </StackPanel>
                                                        
                                                        <!-- Company -->
                                                        <TextBlock Grid.Column="3" 
                                                                   Classes="bodySecondary" 
                                                                   Text="{Binding Company}" 
                                                                   VerticalAlignment="Center"
                                                                   TextTrimming="CharacterEllipsis"/>
                                                        
                                                        <!-- Note Preview Button -->
                                                        <Button Grid.Column="4"
                                                                Classes="noteButton"
                                                                Classes.hasNote="{Binding HasNote}"
                                                                Command="{Binding ToggleNoteCommand}"
                                                                VerticalAlignment="Center"
                                                                ToolTip.Tip="Click Ä‘á»ƒ thÃªm/xem ghi chÃº">
                                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                                <TextBlock Text="ðŸ“" FontSize="12" VerticalAlignment="Center"/>
                                                                <!-- No note placeholder -->
                                                                <TextBlock Text="ThÃªm..."
                                                                           FontSize="11"
                                                                           Foreground="{DynamicResource TextMutedBrush}"
                                                                           VerticalAlignment="Center"
                                                                           IsVisible="{Binding HasNote, Converter={StaticResource InverseBool}}"/>
                                                                <!-- Note preview -->
                                                                <TextBlock Text="{Binding NotePreview}"
                                                                           FontSize="11"
                                                                           Foreground="{DynamicResource WarningTextBrush}"
                                                                           VerticalAlignment="Center"
                                                                           MaxWidth="60"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           IsVisible="{Binding HasNote}"/>
                                                            </StackPanel>
                                                        </Button>
                                                        
                                                        <!-- Status Badge -->
                                                        <Border Grid.Column="5"
                                                                CornerRadius="9999"
                                                                Padding="10,4"
                                                                HorizontalAlignment="Left"
                                                                VerticalAlignment="Center"
                                                                Background="{Binding Status, Converter={StaticResource StatusToBackground}}">
                                                            <TextBlock Text="{Binding Status, Converter={StaticResource StatusToString}}"
                                                                       FontSize="11"
                                                                       FontWeight="Medium"
                                                                       Foreground="{Binding Status, Converter={StaticResource StatusToForeground}}"/>
                                                        </Border>
                                                        
                                                        <!-- Action Buttons - Grid layout for clear spacing -->
                                                        <Grid Grid.Column="6" 
                                                              ColumnDefinitions="36,36,36,36,36,36"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center">
                                                            
                                                            <!-- Interested Button (CÃ³ nhu cáº§u) -->
                                                            <Button Grid.Column="0"
                                                                    Classes="actionIconButton success"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SetInterestedCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsEnabled="{Binding IsActionsEnabled}"
                                                                    ToolTip.Tip="CÃ³ nhu cáº§u">
                                                                <TextBlock Text="ðŸ‘" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                            
                                                            <!-- Not Interested Button (KhÃ´ng nhu cáº§u) -->
                                                            <Button Grid.Column="1"
                                                                    Classes="actionIconButton error"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SetNotInterestedCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsEnabled="{Binding IsActionsEnabled}"
                                                                    ToolTip.Tip="KhÃ´ng nhu cáº§u">
                                                                <TextBlock Text="ðŸ‘Ž" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                            
                                                            <!-- No Answer Button (KhÃ´ng báº¯t mÃ¡y) -->
                                                            <Button Grid.Column="2"
                                                                    Classes="actionIconButton neutral"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SetNoAnswerCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsEnabled="{Binding IsActionsEnabled}"
                                                                    ToolTip.Tip="KhÃ´ng báº¯t mÃ¡y">
                                                                <TextBlock Text="ðŸ”•" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                            
                                                            <!-- Busy Button (MÃ¡y báº­n) -->
                                                            <Button Grid.Column="3"
                                                                    Classes="actionIconButton warning"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SetBusyCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsEnabled="{Binding IsActionsEnabled}"
                                                                    ToolTip.Tip="MÃ¡y báº­n">
                                                                <TextBlock Text="â³" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                            
                                                            <!-- Invalid Number Button (Sá»‘ khÃ´ng tá»“n táº¡i) -->
                                                            <Button Grid.Column="4"
                                                                    Classes="actionIconButton danger"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).SetInvalidNumberCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsEnabled="{Binding IsActionsEnabled}"
                                                                    ToolTip.Tip="Sá»‘ khÃ´ng tá»“n táº¡i">
                                                                <TextBlock Text="ðŸš«" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                            
                                                            <!-- Reset Button -->
                                                            <Button Grid.Column="5"
                                                                    Classes="actionIconButton reset"
                                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ResetStatusCommand}"
                                                                    CommandParameter="{Binding}"
                                                                    IsVisible="{Binding IsActionsEnabled, Converter={StaticResource InverseBool}}"
                                                                    ToolTip.Tip="Äáº·t láº¡i tráº¡ng thÃ¡i">
                                                                <TextBlock Text="â†©ï¸" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Button>
                                                        </Grid>
                                                        
                                                        <!-- Edit Button -->
                                                        <Button Grid.Column="7"
                                                                Classes="iconButton"
                                                                Width="30" Height="30"
                                                                Command="{Binding EnterEditModeCommand}"
                                                                ToolTip.Tip="Chá»‰nh sá»­a thÃ´ng tin"
                                                                VerticalAlignment="Center"
                                                                HorizontalAlignment="Center">
                                                            <TextBlock Text="âœï¸" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Button>
                                                    </Grid>
                                                </Border>
                                                
                                                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                <!-- EDIT MODE -->
                                                <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                <Border x:Name="EditRowBorder"
                                                        Classes="contactRow editing"
                                                        IsVisible="{Binding IsEditing}"
                                                        Padding="16,12">
                                                    
                                                    <StackPanel Spacing="12">
                                                        <!-- Edit Fields Row -->
                                                        <Grid ColumnDefinitions="50,*,140,140,100,140,220,50" VerticalAlignment="Center">
                                                            <!-- ID (readonly) -->
                                                            <TextBlock Grid.Column="0" 
                                                                       Classes="bodySecondary" 
                                                                       Text="{Binding Id}" 
                                                                       VerticalAlignment="Center"/>
                                                            
                                                            <!-- Name Edit -->
                                                            <TextBox Grid.Column="1" 
                                                                     Classes="inlineEdit"
                                                                     Text="{Binding EditName, Mode=TwoWay}"
                                                                     Watermark="TÃªn liÃªn há»‡"
                                                                     Margin="0,0,8,0"
                                                                     VerticalAlignment="Center"/>
                                                            
                                                            <!-- Phone Edit -->
                                                            <StackPanel Grid.Column="2" Margin="0,0,8,0">
                                                                <TextBox Classes="inlineEdit phone"
                                                                         Classes.error="{Binding HasPhoneError}"
                                                                         Text="{Binding EditPhoneNumber, Mode=TwoWay}"
                                                                         Watermark="Sá»‘ Ä‘iá»‡n thoáº¡i"
                                                                         VerticalAlignment="Center"/>
                                                                <TextBlock Classes="errorText"
                                                                           Text="{Binding PhoneNumberError}"
                                                                           IsVisible="{Binding HasPhoneError}"/>
                                                            </StackPanel>
                                                            
                                                            <!-- Company Edit -->
                                                            <TextBox Grid.Column="3" 
                                                                     Classes="inlineEdit"
                                                                     Text="{Binding EditCompany, Mode=TwoWay}"
                                                                     Watermark="CÃ´ng ty"
                                                                     Margin="0,0,8,0"
                                                                     VerticalAlignment="Center"/>
                                                            
                                                            <!-- Note Toggle Button -->
                                                            <Button Grid.Column="4"
                                                                    Classes="noteButton"
                                                                    Classes.hasNote="{Binding HasNote}"
                                                                    Command="{Binding ToggleNoteCommand}"
                                                                    VerticalAlignment="Center"
                                                                    ToolTip.Tip="Má»Ÿ rá»™ng/thu gá»n ghi chÃº">
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <TextBlock Text="ðŸ“" FontSize="12" VerticalAlignment="Center"/>
                                                                    <!-- Show "Thu gá»n" when expanded, "Má»Ÿ" when collapsed -->
                                                                    <TextBlock Text="Thu gá»n" FontSize="11" VerticalAlignment="Center"
                                                                               IsVisible="{Binding IsNoteExpanded}"/>
                                                                    <TextBlock Text="Má»Ÿ" FontSize="11" VerticalAlignment="Center"
                                                                               IsVisible="{Binding IsNoteExpanded, Converter={StaticResource InverseBool}}"/>
                                                                </StackPanel>
                                                            </Button>
                                                            
                                                            <!-- Status Badge (readonly in edit mode) -->
                                                            <Border Grid.Column="5"
                                                                    CornerRadius="9999"
                                                                    Padding="10,4"
                                                                    HorizontalAlignment="Left"
                                                                    VerticalAlignment="Center"
                                                                    Background="{Binding Status, Converter={StaticResource StatusToBackground}}"
                                                                    Opacity="0.6">
                                                                <TextBlock Text="{Binding Status, Converter={StaticResource StatusToString}}"
                                                                           FontSize="11"
                                                                           FontWeight="Medium"
                                                                           Foreground="{Binding Status, Converter={StaticResource StatusToForeground}}"/>
                                                            </Border>
                                                            
                                                            <!-- Save/Cancel Buttons -->
                                                            <StackPanel Grid.Column="6" 
                                                                        Orientation="Horizontal" 
                                                                        Spacing="6"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center">
                                                                <Button Classes="editActionSave"
                                                                        Command="{Binding SaveEditCommand}"
                                                                        IsEnabled="{Binding CanSave}"
                                                                        ToolTip.Tip="LÆ°u thay Ä‘á»•i">
                                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                                        <TextBlock Text="ðŸ’¾" FontSize="11" VerticalAlignment="Center"/>
                                                                        <TextBlock Text="LÆ°u" VerticalAlignment="Center"/>
                                                                    </StackPanel>
                                                                </Button>
                                                                <Button Classes="editActionCancel"
                                                                        Command="{Binding CancelEditCommand}"
                                                                        ToolTip.Tip="Há»§y thay Ä‘á»•i (Esc)">
                                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                                        <TextBlock Text="âŒ" FontSize="11" VerticalAlignment="Center"/>
                                                                        <TextBlock Text="Há»§y" VerticalAlignment="Center"/>
                                                                    </StackPanel>
                                                                </Button>
                                                            </StackPanel>
                                                            
                                                            <!-- Empty column for alignment -->
                                                            <Border Grid.Column="7"/>
                                                        </Grid>
                                                        
                                                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                        <!-- EXPANDABLE NOTE PANEL -->
                                                        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                                                        <Border Classes="noteExpandPanel"
                                                                IsVisible="{Binding IsNoteExpanded}"
                                                                Margin="-16,0,-16,-12">
                                                            <StackPanel Spacing="8">
                                                                <TextBlock Text="ðŸ“ Ghi chÃº cuá»™c gá»i" 
                                                                           FontWeight="SemiBold" 
                                                                           FontSize="12"
                                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                                <TextBox Classes="noteTextArea"
                                                                         Text="{Binding EditNote, Mode=TwoWay}"
                                                                         x:Name="NoteTextBox"
                                                                         KeyDown="OnNoteKeyDown"/>
                                                                
                                                                <!-- Quick Note Options -->
                                                                <StackPanel Spacing="4">
                                                                    <TextBlock Text="âš¡ Ghi chÃº nhanh:" 
                                                                               FontSize="11" 
                                                                               Foreground="{DynamicResource TextMutedBrush}"/>
                                                                    <WrapPanel>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="ðŸ“ž KhÃ¡ch háº¹n gá»i láº¡i"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="KhÃ¡ch háº¹n gá»i láº¡i sau"/>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="â­ KhÃ¡ch tiá»m nÄƒng"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="KhÃ¡ch hÃ ng tiá»m nÄƒng"/>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="âŒ KhÃ´ng cÃ³ nhu cáº§u"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="KhÃ´ng cÃ³ nhu cáº§u"/>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="ðŸ“µ Sai sá»‘/KhÃ´ng liÃªn láº¡c Ä‘Æ°á»£c"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="Sai sá»‘ / KhÃ´ng liÃªn láº¡c Ä‘Æ°á»£c"/>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="ðŸ¤” Cáº§n tÆ° váº¥n thÃªm"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="Cáº§n tÆ° váº¥n thÃªm"/>
                                                                        <Button Classes="quickNoteBtn"
                                                                                Content="âœ… ÄÃ£ chá»‘t Ä‘Æ¡n"
                                                                                Command="{Binding AddQuickNoteCommand}"
                                                                                CommandParameter="ÄÃ£ chá»‘t Ä‘Æ¡n"/>
                                                                    </WrapPanel>
                                                                </StackPanel>
                                                                
                                                                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                                                                    <TextBlock x:Name="NoteHintText"
                                                                               Text="ðŸ’¡ âŒ˜+Enter (Mac) / Ctrl+Enter (Win) Ä‘á»ƒ lÆ°u, Esc Ä‘á»ƒ há»§y" 
                                                                               FontSize="11" 
                                                                               Foreground="{DynamicResource TextMutedBrush}"
                                                                               VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </Border>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </TabControl.ContentTemplate>
                    </TabControl>
                </Grid>
            </Border>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- DELETE CONFIRMATION DIALOG -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              IsVisible="{Binding ShowDeleteConfirmation}"
              ZIndex="200">
            <Border Background="{DynamicResource OverlayBackgroundBrush}"/>
            <Border Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="12"
                    Padding="24"
                    MaxWidth="400"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 25 50 -12 #40000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="ðŸ—‘ï¸ XÃ¡c nháº­n xÃ³a" Classes="heading3" HorizontalAlignment="Center"/>
                    <TextBlock Classes="bodySecondary" TextAlignment="Center" TextWrapping="Wrap">
                        <Run Text="Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a phiÃªn nÃ y khÃ´ng?"/>
                        <LineBreak/>
                        <Run Text="HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c." FontWeight="SemiBold"/>
                    </TextBlock>
                    <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center" Margin="0,8,0,0">
                        <Button Classes="secondary" 
                                Content="Há»§y" 
                                Command="{Binding CancelDeleteSessionCommand}"
                                Padding="20,8"/>
                        <Button Classes="primary error" 
                                Content="XÃ³a phiÃªn" 
                                Command="{Binding ConfirmDeleteSessionCommand}"
                                Padding="20,8"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ONBOARDING OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" Grid.RowSpan="2" 
              IsVisible="{Binding ShowOnboarding}"
              Classes="overlayFadeIn"
              ZIndex="150">
            
            <!-- Dark Overlay -->
            <Border Background="{DynamicResource OverlayBackgroundBrush}"/>
            
            <!-- Onboarding Content -->
            <Border Classes="scaleIn"
                    Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="16"
                    Padding="32"
                    MaxWidth="480"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BoxShadow="0 25 50 -12 #40000000">
                
                <StackPanel Spacing="24">
                    
                    <!-- Step Indicator -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                        <!-- Dot 1: Active when step >= 1 -->
                        <Border Width="32" Height="4" CornerRadius="2"
                                Background="{Binding CurrentOnboardingStep, Converter={StaticResource StepIndicatorBrush}, ConverterParameter=1}"/>
                        
                        <!-- Dot 2: Active when step >= 2 -->
                        <Border Width="32" Height="4" CornerRadius="2"
                                Background="{Binding CurrentOnboardingStep, Converter={StaticResource StepIndicatorBrush}, ConverterParameter=2}"/>
                        
                        <!-- Dot 3: Active when step >= 3 -->
                        <Border Width="32" Height="4" CornerRadius="2"
                                Background="{Binding CurrentOnboardingStep, Converter={StaticResource StepIndicatorBrush}, ConverterParameter=3}"/>
                    </StackPanel>
                    
                    <!-- Step 1 Content -->
                    <StackPanel Spacing="16" IsVisible="{Binding CurrentOnboardingStep, Converter={StaticResource StepToVisibility}, ConverterParameter=1}">
                        <Border Width="64" Height="64" CornerRadius="32" Background="{DynamicResource PrimaryLightBrush}" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ“¥" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Classes="heading2" Text="{Binding OnboardingStep1Title}" HorizontalAlignment="Center"/>
                        <TextBlock Classes="bodySecondary" Text="{Binding OnboardingStep1Description}" TextAlignment="Center" TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <!-- Step 2 Content -->
                    <StackPanel Spacing="16" IsVisible="{Binding CurrentOnboardingStep, Converter={StaticResource StepToVisibility}, ConverterParameter=2}">
                        <Border Width="64" Height="64" CornerRadius="32" Background="{DynamicResource SuccessLightBrush}" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ“ž" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Classes="heading2" Text="{Binding OnboardingStep2Title}" HorizontalAlignment="Center"/>
                        <TextBlock Classes="bodySecondary" Text="{Binding OnboardingStep2Description}" TextAlignment="Center" TextWrapping="Wrap"/>
                        
                        <!-- Action buttons preview -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12" Margin="0,8,0,0">
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <Border Width="36" Height="36" CornerRadius="18" Background="{DynamicResource SuccessLightBrush}" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ“ž" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Classes="caption" Text="Nghe mÃ¡y" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <Border Width="36" Height="36" CornerRadius="18" Background="{DynamicResource NeutralLightBrush}" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ”•" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Classes="caption" Text="KhÃ´ng nghe" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <Border Width="36" Height="36" CornerRadius="18" Background="{DynamicResource ErrorLightBrush}" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸš«" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Classes="caption" Text="Sá»‘ sai" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Spacing="4" HorizontalAlignment="Center">
                                <Border Width="36" Height="36" CornerRadius="18" Background="{DynamicResource WarningLightBrush}" HorizontalAlignment="Center">
                                    <TextBlock Text="â³" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Classes="caption" Text="MÃ¡y báº­n" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Step 3 Content -->
                    <StackPanel Spacing="16" IsVisible="{Binding CurrentOnboardingStep, Converter={StaticResource StepToVisibility}, ConverterParameter=3}">
                        <Border Width="64" Height="64" CornerRadius="32" Background="{DynamicResource WarningLightBrush}" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ“¤" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Classes="heading2" Text="{Binding OnboardingStep3Title}" HorizontalAlignment="Center"/>
                        <TextBlock Classes="bodySecondary" Text="{Binding OnboardingStep3Description}" TextAlignment="Center" TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <!-- Navigation Buttons -->
                    <Grid ColumnDefinitions="*,Auto,*">
                        <!-- Skip / Don't show again -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                            <Button Classes="secondary" 
                                    Content="Bá» qua" 
                                    Command="{Binding SkipOnboardingCommand}"
                                    Padding="12,8"/>
                        </StackPanel>
                        
                        <!-- Next / Finish Button -->
                        <Button Grid.Column="2" 
                                Classes="primary" 
                                HorizontalAlignment="Right"
                                Command="{Binding NextOnboardingStepCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Tiáº¿p tá»¥c" VerticalAlignment="Center"/>
                                <TextBlock Text="â†’" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                    
                    <!-- Don't show again checkbox -->
                    <Button Classes="secondary" 
                            Content="KhÃ´ng hiá»ƒn thá»‹ láº¡i" 
                            Command="{Binding DontShowAgainCommand}"
                            HorizontalAlignment="Center"
                            Padding="12,6"
                            FontSize="12"
                            Foreground="{DynamicResource TextMutedBrush}"/>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- SETTINGS PANEL OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              IsVisible="{Binding ShowSettings}"
              ZIndex="200">
            
            <!-- Background Overlay -->
            <Border Background="{DynamicResource OverlayBackgroundBrush}"
                    PointerPressed="SettingsOverlay_PointerPressed"/>
            
            <!-- Settings Panel -->
            <Border Background="{DynamicResource CardBackgroundBrush}"
                    Width="520"
                    CornerRadius="16"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Margin="40"
                    BoxShadow="0 8 32 0 #40000000">
                
                <Grid RowDefinitions="Auto,*,Auto">
                    
                    <!-- Header with close button -->
                    <Border Grid.Row="0"
                            BorderBrush="{DynamicResource BorderLightBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="20,16">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Classes="heading2" Text="âš™ï¸ Settings" VerticalAlignment="Center"/>
                            <Button Grid.Column="1"
                                    Classes="iconButton"
                                    Command="{Binding CloseSettingsCommand}"
                                    ToolTip.Tip="ÄÃ³ng Settings">
                                <TextBlock Text="âœ•" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Button>
                        </Grid>
                    </Border>
                    
                    <!-- Settings Content -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="20,20,20,0">
                        
                        <StackPanel Spacing="20" DataContext="{Binding SettingsViewModel}" Margin="0,0,0,20">
                            
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <!-- SECURITY SECTION -->
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <Border Background="{DynamicResource AppBackgroundBrush}"
                                    CornerRadius="12"
                                    Padding="16">
                                <StackPanel Spacing="12">
                                    
                                    <!-- Section Header -->
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="ðŸ”" FontSize="18"/>
                                        <TextBlock Classes="heading3" Text="Security" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <Border Height="1" Background="{DynamicResource BorderLightBrush}"/>
                                    
                                    <!-- Unlocked State -->
                                    <StackPanel IsVisible="{Binding IsUnlocked}" Spacing="10">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="âœ”ï¸" FontSize="14" Foreground="{DynamicResource SuccessTextBrush}"/>
                                            <TextBlock Text="Settings unlocked" 
                                                       Classes="body"
                                                       Foreground="{DynamicResource SuccessTextBrush}"
                                                       FontWeight="Medium"/>
                                        </StackPanel>
                                        
                                        <Button Classes="secondary"
                                                Command="{Binding LockCommand}"
                                                HorizontalAlignment="Left"
                                                Padding="12,8">
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="ðŸ”’" FontSize="12"/>
                                                <TextBlock Text="Lock Settings"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                    
                                    <!-- Locked State -->
                                    <StackPanel IsVisible="{Binding !IsUnlocked}" Spacing="10">
                                        <TextBlock Classes="bodySecondary" 
                                                   Text="Nháº­p máº­t kháº©u Ä‘á»ƒ truy cáº­p cÃ i Ä‘áº·t"/>
                                        
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBox Grid.Column="0"
                                                     PasswordChar="â—"
                                                     Text="{Binding PasswordInput, Mode=TwoWay}"
                                                     Watermark="Máº­t kháº©u"
                                                     Margin="0,0,10,0"/>
                                            <Button Grid.Column="1"
                                                    Classes="primary"
                                                    Command="{Binding UnlockCommand}"
                                                    Padding="16,8">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <TextBlock Text="ðŸ”“" FontSize="12"/>
                                                    <TextBlock Text="Unlock"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>
                                        
                                        <!-- Password Error -->
                                        <Border IsVisible="{Binding ShowPasswordError}"
                                                Background="{DynamicResource ErrorLightBrush}"
                                                CornerRadius="6"
                                                Padding="10,8">
                                            <TextBlock Text="{Binding PasswordError}"
                                                       Foreground="{DynamicResource ErrorTextBrush}"
                                                       FontSize="12"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <!-- TELEGRAM BOT SECTION -->
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <Border Background="{DynamicResource AppBackgroundBrush}"
                                    CornerRadius="12"
                                    Padding="16"
                                    IsEnabled="{Binding IsUnlocked}">
                                <Border.Opacity>
                                    <Binding Path="IsUnlocked">
                                        <Binding.Converter>
                                            <conv:BoolToOpacityConverter/>
                                        </Binding.Converter>
                                    </Binding>
                                </Border.Opacity>
                                
                                <StackPanel Spacing="12">
                                    
                                    <!-- Section Header -->
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="ðŸ¤–" FontSize="18"/>
                                        <TextBlock Classes="heading3" Text="Telegram Bot" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <Border Height="1" Background="{DynamicResource BorderLightBrush}"/>
                                    
                                    <!-- Locked Message -->
                                    <Border IsVisible="{Binding !IsUnlocked}"
                                            Background="{DynamicResource WarningLightBrush}"
                                            CornerRadius="6"
                                            Padding="10,8">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="ðŸ”’" FontSize="12"/>
                                            <TextBlock Text="Unlock Ä‘á»ƒ truy cáº­p cÃ i Ä‘áº·t nÃ y"
                                                       Foreground="{DynamicResource WarningTextBrush}"
                                                       FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Telegram Form -->
                                    <StackPanel IsVisible="{Binding IsUnlocked}" Spacing="14">
                                        
                                        <!-- Bot Token -->
                                        <StackPanel Spacing="4">
                                            <TextBlock Classes="body" Text="Bot Token" FontWeight="Medium"/>
                                            <TextBox Text="{Binding TelegramBotToken, Mode=TwoWay}"
                                                     Watermark="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"/>
                                            <TextBlock IsVisible="{Binding ShowBotTokenError}"
                                                       Text="{Binding BotTokenError}"
                                                       Foreground="{DynamicResource ErrorTextBrush}"
                                                       FontSize="11"/>
                                        </StackPanel>
                                        
                                        <!-- Chat ID -->
                                        <StackPanel Spacing="4">
                                            <TextBlock Classes="body" Text="Chat ID" FontWeight="Medium"/>
                                            <TextBox Text="{Binding TelegramChatId, Mode=TwoWay}"
                                                     Watermark="-1001234567890"/>
                                            <TextBlock IsVisible="{Binding ShowChatIdError}"
                                                       Text="{Binding ChatIdError}"
                                                       Foreground="{DynamicResource ErrorTextBrush}"
                                                       FontSize="11"/>
                                        </StackPanel>
                                        
                                        <!-- Help Info -->
                                        <Border Background="{DynamicResource NeutralLightBrush}"
                                                CornerRadius="6"
                                                Padding="10,8">
                                            <StackPanel Spacing="2">
                                                <TextBlock Classes="caption" FontWeight="SemiBold" Text="ðŸ’¡ HÆ°á»›ng dáº«n"/>
                                                <TextBlock Classes="caption" 
                                                           TextWrapping="Wrap"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           FontSize="11"
                                                           LineHeight="16">
                                                    <Run Text="1. Táº¡o bot táº¡i @BotFather"/>
                                                    <LineBreak/>
                                                    <Run Text="2. Copy Bot Token"/>
                                                    <LineBreak/>
                                                    <Run Text="3. Láº¥y Chat ID tá»« @userinfobot"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Clear Button -->
                                        <Button Classes="secondary"
                                                Command="{Binding ClearSensitiveDataCommand}"
                                                HorizontalAlignment="Left"
                                                Margin="0,6,0,0"
                                                Padding="12,8"
                                                ToolTip.Tip="XÃ³a toÃ n bá»™ cÃ i Ä‘áº·t Telegram">
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="ðŸ—‘ï¸" FontSize="12"/>
                                                <TextBlock Text="XÃ³a cÃ i Ä‘áº·t Telegram"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <!-- DAILY REPORT SECTION -->
                            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
                            <Border Background="{DynamicResource AppBackgroundBrush}"
                                    CornerRadius="12"
                                    Padding="16"
                                    IsEnabled="{Binding IsUnlocked}">
                                <Border.Opacity>
                                    <Binding Path="IsUnlocked">
                                        <Binding.Converter>
                                            <conv:BoolToOpacityConverter/>
                                        </Binding.Converter>
                                    </Binding>
                                </Border.Opacity>
                                
                                <StackPanel Spacing="12">
                                    
                                    <!-- Section Header -->
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="ðŸ“Š" FontSize="18"/>
                                        <TextBlock Classes="heading3" Text="Daily Report" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <Border Height="1" Background="{DynamicResource BorderLightBrush}"/>
                                    
                                    <!-- Locked Message -->
                                    <Border IsVisible="{Binding !IsUnlocked}"
                                            Background="{DynamicResource WarningLightBrush}"
                                            CornerRadius="6"
                                            Padding="10,8">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="ðŸ”’" FontSize="12"/>
                                            <TextBlock Text="Unlock Ä‘á»ƒ truy cáº­p cÃ i Ä‘áº·t nÃ y"
                                                       Foreground="{DynamicResource WarningTextBrush}"
                                                       FontSize="12"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Daily Report Settings -->
                                    <StackPanel IsVisible="{Binding IsUnlocked}" Spacing="14">
                                        
                                        <!-- Enable Auto Send Toggle -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <StackPanel Grid.Column="0" Spacing="2">
                                                <TextBlock Classes="body" Text="Tá»± Ä‘á»™ng gá»­i Daily Report" FontWeight="Medium"/>
                                                <TextBlock Classes="caption" 
                                                           Text="Gá»­i bÃ¡o cÃ¡o tá»± Ä‘á»™ng theo giá» cáº¥u hÃ¬nh" 
                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                            <ToggleSwitch Grid.Column="1" 
                                                          IsChecked="{Binding EnableAutoSendDailyReport, Mode=TwoWay}"
                                                          OnContent="Báº­t"
                                                          OffContent="Táº¯t"/>
                                        </Grid>
                                        
                                        <!-- Send Time Picker -->
                                        <StackPanel Spacing="4" IsEnabled="{Binding EnableAutoSendDailyReport}">
                                            <TextBlock Classes="body" Text="Giá» gá»­i bÃ¡o cÃ¡o" FontWeight="Medium"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <ComboBox Width="70"
                                                          SelectedItem="{Binding SelectedHour, Mode=TwoWay}"
                                                          ItemsSource="{Binding AvailableHours}">
                                                    <ComboBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding StringFormat={}{0:D2}}"/>
                                                        </DataTemplate>
                                                    </ComboBox.ItemTemplate>
                                                </ComboBox>
                                                <TextBlock Text=":" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                                                <ComboBox Width="70"
                                                          SelectedItem="{Binding SelectedMinute, Mode=TwoWay}"
                                                          ItemsSource="{Binding AvailableMinutes}">
                                                    <ComboBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding StringFormat={}{0:D2}}"/>
                                                        </DataTemplate>
                                                    </ComboBox.ItemTemplate>
                                                </ComboBox>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Info Box -->
                                        <Border Background="{DynamicResource NeutralLightBrush}"
                                                CornerRadius="6"
                                                Padding="10,8">
                                            <StackPanel Spacing="2">
                                                <TextBlock Classes="caption" FontWeight="SemiBold" Text="ðŸ’¡ Ghi chÃº"/>
                                                <TextBlock Classes="caption" 
                                                           TextWrapping="Wrap"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           FontSize="11"
                                                           LineHeight="16">
                                                    <Run Text="â€¢ Daily Report tá»•ng há»£p cuá»™c gá»i trong ngÃ y"/>
                                                    <LineBreak/>
                                                    <Run Text="â€¢ Chá»‰ gá»­i khi app Ä‘ang cháº¡y"/>
                                                    <LineBreak/>
                                                    <Run Text="â€¢ Má»—i ngÃ y chá»‰ gá»­i 1 láº§n"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- Security Info -->
                            <Border Background="{DynamicResource NeutralLightBrush}"
                                    CornerRadius="8"
                                    Padding="12">
                                <StackPanel Spacing="4">
                                    <TextBlock Classes="caption" 
                                               FontWeight="SemiBold" 
                                               Text="ðŸ›¡ï¸ ThÃ´ng tin báº£o máº­t"/>
                                    <TextBlock Classes="caption" 
                                               TextWrapping="Wrap"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="11"
                                               LineHeight="16">
                                        <Run Text="â€¢ Máº­t kháº©u SHA-256, khÃ´ng lÆ°u plain text"/>
                                        <LineBreak/>
                                        <Run Text="â€¢ CÃ i Ä‘áº·t lÆ°u cá»¥c bá»™ trÃªn mÃ¡y"/>
                                        <LineBreak/>
                                        <Run Text="â€¢ Khá»Ÿi Ä‘á»™ng láº¡i app cáº§n unlock láº¡i"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            
                        </StackPanel>
                    </ScrollViewer>
                    
                    <!-- Fixed Footer with Save Button -->
                    <Border Grid.Row="2"
                            BorderBrush="{DynamicResource BorderLightBrush}"
                            BorderThickness="0,1,0,0"
                            Padding="20,16"
                            Background="{DynamicResource CardBackgroundBrush}">
                        <Grid ColumnDefinitions="*,Auto" DataContext="{Binding SettingsViewModel}">
                            
                            <!-- Status Message in Footer -->
                            <Border Grid.Column="0"
                                    IsVisible="{Binding ShowStatusMessage}"
                                    CornerRadius="6"
                                    Padding="10,6"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Left">
                                <Panel>
                                    <!-- Success -->
                                    <Border IsVisible="{Binding IsStatusSuccess}"
                                            Background="{DynamicResource SuccessLightBrush}"
                                            CornerRadius="6"
                                            Margin="-10,-6"
                                            Padding="10,6">
                                        <TextBlock Text="{Binding StatusMessage}"
                                                   Foreground="{DynamicResource SuccessTextBrush}"
                                                   FontWeight="Medium"
                                                   FontSize="12"/>
                                    </Border>
                                    <!-- Error -->
                                    <Border IsVisible="{Binding !IsStatusSuccess}"
                                            Background="{DynamicResource ErrorLightBrush}"
                                            CornerRadius="6"
                                            Margin="-10,-6"
                                            Padding="10,6">
                                        <TextBlock Text="{Binding StatusMessage}"
                                                   Foreground="{DynamicResource ErrorTextBrush}"
                                                   FontWeight="Medium"
                                                   FontSize="12"/>
                                    </Border>
                                </Panel>
                            </Border>
                            
                            <!-- Save Button -->
                            <Button Grid.Column="1"
                                    Classes="primary"
                                    Command="{Binding SaveSettingsCommand}"
                                    IsEnabled="{Binding !IsSaving}"
                                    Padding="20,10">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="ðŸ’¾" FontSize="14"/>
                                    <TextBlock FontSize="14" FontWeight="Medium">
                                        <TextBlock.Text>
                                            <Binding Path="IsSaving">
                                                <Binding.Converter>
                                                    <conv:BoolToSavingTextConverter/>
                                                </Binding.Converter>
                                            </Binding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- SEND REPORT POPUP OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              IsVisible="{Binding ShowSendReport}"
              ZIndex="300">
            
            <!-- Background Overlay -->
            <Border Background="{DynamicResource OverlayBackgroundBrush}"
                    PointerPressed="SendReportOverlay_PointerPressed"/>
            
            <!-- Send Report Panel -->
            <ContentControl Content="{Binding SendReportViewModel}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                <ContentControl.ContentTemplate>
                    <DataTemplate DataType="vm:SendReportViewModel">
                        <local:SendReportView DataContext="{Binding}"/>
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- DAILY REPORT PREVIEW POPUP OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Row="0" Grid.RowSpan="2"
              IsVisible="{Binding ShowDailyReportPreview}"
              ZIndex="350">
            
            <!-- Background Overlay -->
            <Border Background="{DynamicResource OverlayBackgroundBrush}"
                    PointerPressed="DailyReportPreviewOverlay_PointerPressed"/>
            
            <!-- Daily Report Preview Panel -->
            <ContentControl Content="{Binding DailyReportPreviewViewModel}"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                <ContentControl.ContentTemplate>
                    <DataTemplate DataType="vm:DailyReportPreviewViewModel">
                        <local:DailyReportPreviewView DataContext="{Binding}"/>
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </Grid>
        
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- TOAST NOTIFICATION OVERLAY -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <local:NotificationView Grid.Row="0" Grid.RowSpan="2"
                                DataContext="{Binding NotificationViewModel}"
                                ZIndex="999"/>
    </Grid>
</Window>
